<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Notícias • Vyre</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800;900&display=swap" rel="stylesheet"/>

<style>
/* ===== VARIÁVEIS (IGUAIS ÔNIBUS) ===== */
:root{
  --header: linear-gradient(180deg,#2f6f9d 0%,#184c75 55%,#0f3b5e 100%);
  --bg: radial-gradient(1200px 900px at 25% 10%, rgba(87,184,231,.22), rgba(10,46,62,0) 65%),
        radial-gradient(1100px 800px at 90% 80%, rgba(255,255,255,.08), rgba(10,46,62,0) 60%),
        #0a2e3e;
  --card: rgba(255,255,255,.14);
  --card2: rgba(255,255,255,.10);
  --line: rgba(255,255,255,.18);
  --txt: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.75);
  --shadow: 0 18px 50px rgba(0,0,0,.35);
  --radius: 22px;
  --radiusSm: 18px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--txt);
  background: var(--bg);
  overflow:hidden;
}
.wrap{
  height:100%;
  display:flex;
  flex-direction:column;
}
header{
  height:82px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 0 22px;
  background: var(--header);
  box-shadow: 0 10px 30px rgba(0,0,0,.28);
}
.hleft{display:flex;align-items:center;gap:12px}
.badge{
  width:44px;height:44px;border-radius:14px;
  background: rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.25);
  display:flex;align-items:center;justify-content:center;
  box-shadow: 0 10px 24px rgba(0,0,0,.25);
}
.badge .material-icons-outlined{font-size:24px}
.htitle{display:flex;flex-direction:column;line-height:1.05}
.htitle b{font-size:18px;letter-spacing:.2px}
.htitle span{font-size:12px;color:var(--muted)}
.hright{
  display:flex;align-items:center;gap:16px;
  font-weight:600;
}
.pill{
  display:flex;align-items:center;gap:8px;
  padding:10px 14px;
  border-radius: 999px;
  background: rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.22);
  box-shadow: 0 12px 30px rgba(0,0,0,.18);
}
.dot{width:9px;height:9px;border-radius:99px;background:#49d17e;box-shadow:0 0 0 4px rgba(73,209,126,.18)}
.dot.off{background:#ff6b6b;box-shadow:0 0 0 4px rgba(255,107,107,.18)}
main{
  flex:1;
  padding: 18px 22px 22px;
  display:grid;
  grid-template-columns: 1fr 460px;
  gap:18px;
}
.card{
  border-radius: var(--radius);
  background: linear-gradient(180deg, var(--card), var(--card2));
  border:1px solid var(--line);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.hero{
  position:relative;
  display:flex;
  flex-direction:column;
  min-height: 520px;
}
.hero img{
  width:100%;
  height:100%;
  object-fit:cover;
  position:absolute;
  inset:0;
  filter: saturate(1.05) contrast(1.05);
}
.hero::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(90deg, rgba(0,0,0,.55), rgba(0,0,0,.05) 62%);
}
.heroContent{
  position:relative;
  z-index:2;
  padding: 26px 26px 22px;
  display:flex;
  flex-direction:column;
  height:100%;
  justify-content:flex-end;
}
.heroTitle{
  font-size:44px;
  font-weight:900;
  line-height:1.05;
  letter-spacing:-.5px;
  text-shadow: 0 14px 30px rgba(0,0,0,.45);
}
.heroMeta{
  margin-top:14px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.tag{
  padding:8px 12px;
  border-radius: 999px;
  font-weight:700;
  font-size:12px;
  background: rgba(255,255,255,.14);
  border: 1px solid rgba(255,255,255,.24);
  color: rgba(255,255,255,.9);
}
.side{
  display:flex;
  flex-direction:column;
  gap:18px;
}
.side .card{
  padding: 18px;
}
.side h3{
  margin:0 0 10px;
  font-size:16px;
  letter-spacing:.2px;
}
.kv{
  display:flex;
  justify-content:space-between;
  padding:10px 0;
  border-bottom:1px solid rgba(255,255,255,.14);
  color: rgba(255,255,255,.86);
}
.kv:last-child{border-bottom:0}
.small{
  font-size:12px;color:var(--muted)
}
footer{
  height:58px;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  padding: 0 22px;
  color: rgba(255,255,255,.65);
  font-weight:600;
}
@media (max-width: 1100px){
  main{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="hleft">
      <div class="badge"><span class="material-icons-outlined">newspaper</span></div>
      <div class="htitle">
        <b>Notícias</b>
        <span>Atualizações oficiais • Saúde e Institucional</span>
      </div>
    </div>
    <div class="hright">
      <div class="pill"><span id="clock">--:--</span></div>
      <div class="pill"><span class="dot" id="dot"></span><span id="statusText">--</span></div>
    </div>
  </header>

  <main>
    <section class="card hero">
      <img id="image"/>
      <div class="heroContent">
        <div class="heroTitle" id="title">Carregando…</div>
        <div class="heroMeta">
          <span class="tag" id="source">Fonte</span>
          <span class="tag" id="date"></span>
        </div>
      </div>
    </section>

    <aside class="side">
      <div class="card">
        <h3>Resumo</h3>
        <div class="kv"><span>Última atualização</span><span class="small" id="updatedAt">—</span></div>
        <div class="kv"><span>Itens no feed</span><span class="small" id="count">—</span></div>
        <div class="kv"><span>Escopos</span><span class="small" id="scopes">—</span></div>
      </div>
      <div class="card">
        <h3>Dicas</h3>
        <div class="small">
          Conteúdos puxados automaticamente de fontes oficiais configuradas no pipeline.
        </div>
      </div>
    </aside>
  </main>

  <footer>
    <span class="small">Pontoview • Vyre</span>
    <img id="logo" src="./assets/logo-pontoview.png" alt="" style="height:22px;margin-left:10px;opacity:.65"/>
  </footer>
</div>

<script>
/* ===== DOM ===== */
const clock = document.getElementById("clock");
const dot = document.getElementById("dot");
const statusText = document.getElementById("statusText");

const imgEl = document.getElementById("image");
const titleEl = document.getElementById("title");
const sourceEl = document.getElementById("source");
const dateEl = document.getElementById("date");

/* ===== CLOCK ===== */
function tickClock(){
  if (!clock) return;
  clock.textContent = new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
}
tickClock();
setInterval(tickClock, 1000);

/* ===== ONLINE / OFFLINE ===== */
function updateStatus(){
  if(!statusText || !dot) return;
  if(navigator.onLine){
    statusText.textContent="Online";
    dot.classList.remove("off");
  }else{
    statusText.textContent="Offline";
    dot.classList.add("off");
  }
}
window.addEventListener("online",updateStatus);
window.addEventListener("offline",updateStatus);
updateStatus();

/* ===== IMAGE PROXY (hotlink-safe) ===== */
const FALLBACK_IMAGE = "https://images.unsplash.com/photo-1504711432869-0df30a7e04ad?q=80&w=1000&auto=format&fit=crop";

function proxy(url) {
  if (!url || String(url).includes("null")) return FALLBACK_IMAGE;

  // WSRV ajuda a contornar bloqueios de hotlink/referrer
  // Aceita sem protocolo (ex: example.com/img.jpg)
  const clean = String(url).trim().replace(/^https?:\/\//i, "");
  return "https://wsrv.nl/?url=" + encodeURIComponent(clean) + "&w=1100&af";
}

/* ===== LOAD NEWS ===== */
fetch("./data/news.json?" + Date.now())
  .then(r => r.json())
  .then(data => {
    const items = data.items || [];
    if (!items.length) return;

    // Resumo lateral (se existir no JSON)
    const updatedAtEl = document.getElementById("updatedAt");
    const countEl = document.getElementById("count");
    const scopesEl = document.getElementById("scopes");

    if (updatedAtEl && data.generatedAt) {
      const d = new Date(data.generatedAt);
      updatedAtEl.textContent = !isNaN(d) ? d.toLocaleString("pt-BR") : String(data.generatedAt);
    }
    if (countEl) countEl.textContent = String(items.length);

    const scopes = [...new Set(items.map(i => i.scope).filter(Boolean))];
    if (scopesEl) scopesEl.textContent = scopes.length ? scopes.join(" • ") : "—";

    // configurações do <img> sem mexer no layout
    if (imgEl) {
      imgEl.loading = "eager";
      imgEl.decoding = "async";
      imgEl.referrerPolicy = "no-referrer";
      imgEl.alt = "Imagem da notícia";
    }

    let idx = 0;

    function setImage(url){
      if(!imgEl) return;
      const finalUrl = proxy(url);

      // fallback robusto caso o proxy não consiga carregar
      imgEl.onerror = () => { imgEl.src = FALLBACK_IMAGE; };
      imgEl.src = finalUrl;
    }

    function showNext() {
      const item = items[idx];

      if (titleEl) titleEl.textContent = item.title || "Notícias";
      if (sourceEl) sourceEl.textContent = item.source || "Notícias";

      if (dateEl) {
        const d = item.publishedAt ? new Date(item.publishedAt) : null;
        dateEl.textContent = d && !isNaN(d) ? d.toLocaleDateString("pt-BR", { day:"2-digit", month:"2-digit", year:"numeric" }) : "";
      }

      setImage(item.image);

      idx = (idx + 1) % items.length;
    }

    showNext();
    setInterval(showNext, 15000); // 15s por notícia
  })
  .catch(() => {
    updateStatus();
  });
</script>
</body>
</html>
